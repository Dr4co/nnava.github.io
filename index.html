<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Nordnet/Avanza-sammanställning">
        <meta name="author" content="lillaekonomen">

        <title>Nordnet/Avanza-sammanställning</title>
        <link rel="stylesheet" href="styles/bootstrap.min.css" />
        <link rel="stylesheet" href="styles/kendo.common.min.css" />

        <link rel="stylesheet" href="styles/kendo.bootstrap.min.css" />
        <link rel="stylesheet" href="styles/kendo.bootstrap.mobile.min.css" />
        <link rel="stylesheet" href="styles/kendo.common-bootstrap.min.css" />
        <link rel="stylesheet" href="styles/styles.css" />

        <script>

            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-89118659-1', 'auto');
            ga('send', 'pageview');

        </script>
    </head>
    <body>

        <input type="text" id="nordnetData" class="k-textbox hidden"></input>
        <input type="text" id="avanzaData" class="k-textbox hidden"></input>

        <ul class="nav nav-tabs navbar-default">
            <a class="navbar-brand" data-toggle="tab" href="#home">
                <img alt="Brand" src="/styles/images/icon32x32.png">
            </a>
            <li class="active"><a data-toggle="tab" href="#home">Hem</a></li>
            <li><a data-toggle="tab" href="#faq">FAQ</a></li>
        </ul>

        <div class="tab-content">
            <div id="home" class="tab-pane fade in active">
                <div id="mainContent">
                    <div class="container-fluid">

                        <div class="row-fluid">
                            <div class="col-lg-6">
                                <h3>Nordnet/Avanza-sammanställning</h3>
                                <p>
                                    <input type="file" name="files" id="dataFiles" />
                                </p>
                            </div>
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <h3>Inställningar</h3>
                                    <p>
                                        <input type="checkbox" id="checkboxTax" class="k-checkbox" checked="checked">
                                        <label class="k-checkbox-label" for="checkboxTax">Exkludera källskatt (ej klar för TreeMap)</label>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="row-fluid">
                            <div class="col-lg-12">
                                <p>
                                    <button id="btnExportToPdf" class='export-pdf k-primary k-button'>Exportera till PDF</button>
                                </p>
                            </div>
                        </div>

                        <div class="row-fluid">
                            <div class="col-lg-12">
                                <div>
                                    <h4>Kostnader per månad</h4>
                                    <p>
                                        <input id="inputMonthParent" class="inputMonthNumberParent" type="number" min="0" value="0" step="100" />
                                        <button id="btnSetInputMonthValues" class='k-button'>Sätt kostnad för alla månader</button>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br/>
                    <div class="content-wrapper">
                        <div class="container-fluid">
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div class="inputMonth">
                                        <label for="inputJanuari">Januari</label><br/>
                                        <input id="inputJanuari" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputFebruari">Februari</label><br/>
                                        <input id="inputFebruari" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputMars">Mars</label><br/>
                                        <input id="inputMars" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputApril">April</label><br/>
                                        <input id="inputApril" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputMaj">Maj</label><br/>
                                        <input id="inputMaj" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputJuni">Juni</label><br/>
                                        <input id="inputJuni" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputJuli">Juli</label><br/>
                                        <input id="inputJuli" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputAugusti">Augusti</label><br/>
                                        <input id="inputAugusti" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputSeptember">September</label><br/>
                                        <input id="inputSeptember" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputOktober">Oktober</label><br/>
                                        <input id="inputOktober" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputNovember">November</label><br/>
                                        <input id="inputNovember" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                    <div class="inputMonth">
                                        <label for="inputDecember">December</label><br/>
                                        <input id="inputDecember" class="inputMonthNumber" type="number" min="0" value="21800" step="100" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-fluid">
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartDividendExpensesMonth"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartDividendYearGrowth"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartDonutDividendTotal"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartDividendYearMonth"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartDividendExpensesMonth"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="treeMapDividend"></div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="col-lg-12">
                                    <div id="chartYearDeposit"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="faq" class="tab-pane fade">
                <br/>
                <div class="container-fluid">
                    <div class="panel-group" id="faqAccordion">
                        <div class="panel panel-default">
                            <div class="panel-heading accordion-toggle question-toggle collapsed" data-toggle="collapse" data-parent="#faqAccordion" data-target="#question0">
                                <h4 class="panel-title">
                                    <a href="#" class="ing">F: Vad gör denna sida?</a>
                                </h4>
                            </div>
                            <div id="question0" class="panel-collapse collapse" style="height: 0px;">
                                <div class="panel-body">
                                    <h5><span class="label label-primary">Svar</span></h5>

                                    <p>Den här sidan presenterar portföljinformation, främst gällande utdelningar, med hjälp av transaktionsdata från Nordnet och Avanza.
                                    </p>
                                </div>
                            </div>
                        </div>       

                        <div class="panel panel-default">
                            <div class="panel-heading accordion-toggle question-toggle collapsed" data-toggle="collapse" data-parent="#faqAccordion" data-target="#question1">
                                <h4 class="panel-title">
                                    <a href="#" class="ing">F: Hur gör jag?</a>
                                </h4>
                            </div>
                            <div id="question1" class="panel-collapse collapse" style="height: 0px;">
                                <div class="panel-body">
                                    <h5><span class="label label-primary">Svar</span></h5>

                                    <p>För att kunna generera information så krävs transaktionsdata från Avanza eller Nordnet som läggs till via knappen <strong>Välj fil</strong>. Du kan lägga till fil från både Avanza och Nordnet. <br/>
                                        <br/>
                                        Beskrivning för hur du exporterar den fil som behövs:
                                        <h4>Avanza</h4>
                                        <ol>
                                            <li>Logga in</li>
                                            <li>Klicka på <strong>Mina sidor</strong> och undermenyn <strong>Kontoöversikt</strong></li>
                                            <li>Klicka på fliken <strong>Transaktioner</strong></li>
                                            <li>Välj period (datum) - med fördel all historik sedan start</li>
                                            <li>Skrolla längst ner på sidan</li>
                                            <li>Klicka på knappen <strong>Exportera transaktioner till Excel</strong></li>
                                        </ol>

                                        <h4>Nordnet</h4>
                                        <ol>
                                            <li>Logga in</li>
                                            <li>Välj konto</li>
                                            <li>Klicka på fliken <strong>Transaktioner och notor</strong></li>
                                            <li>Välj period (datum) - med fördel all historik sedan start</li>
                                            <li>Klicka på <strong>Uppdatera</strong></li>
                                            <li>Klicka på knappen med Excel-ikon placerad till höger ovanför transaktionslistan</li>
                                        </ol>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading accordion-toggle question-toggle collapsed" data-toggle="collapse" data-parent="#faqAccordion" data-target="#question2">
                                <h4 class="panel-title">
                                    <a href="#" class="ing">F: Vad händer med filen jag lägger till på denna sida?</a>
                                </h4>
                            </div>
                            <div id="question2" class="panel-collapse collapse" style="height: 0px;">
                                <div class="panel-body">
                                    <h5><span class="label label-primary">Svar</span></h5>

                                    <p>Inläsning av filen som läggs till på sidan sker i webbläsaren på användarens dator. Följande kodsnutt används för att läsa filen och sker efter att fil har lagts till.
                                        <br/>
                                        <pre>
$.each(e.files, function (index, value) {
    
    var extension = value.extension.toLowerCase();
    if (ALLOWED_EXTENSIONS.indexOf(extension) == -1) {
        alert("Endast fil med filformat CSV");
        e.preventDefault();
    }

    var reader = new FileReader();
    reader.onload = function(e) {
        var jsonResultString = getBankSourceJsonData(reader.result);                  
        var isFileAvanza = reader.result.startsWith("Datum");

        if(isFileAvanza)
            $('#avanzaData').val(jsonResultString);
        else
            $('#nordnetData').val(jsonResultString);

        $("#btnExportToPdf").kendoButton().data("kendoButton").enable(true);

        if(loadControlsWaiter == 0)
            appControlLoader.loadControls();

        loadControlsWaiter--;
    }

    reader.readAsText(value.rawFile, 'ISO-8859-1');
});</pre>
                                För den mer nyfikna så finns källkoden öppen att läsa/hämta/bidra till på följande adress: <a href="https://github.com/nnava/nnava.github.io" class="label label-success">nnava.github.io</a>

                                    </p>
                                </div>
                            </div>
                        </div>     

                    </div>
                </div>    
            </div>
        </div>
        
        <script src="/js/jquery.min.js"></script>
        <script src="/js/alasql.min.js"></script>
        <script src="/js/kendo.all.min.js"></script>
        <script src="/js/kendo.culture.se-SE.min.js"></script>
        <script src="/js/pako_deflate.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            var versionNumber = 9;
            var require = {
                waitSeconds: 15,
                urlArgs : "bust="+ versionNumber
            };
        </script>
        <script data-main="js/app" src="js/require.js"></script>
    </body>
</html>